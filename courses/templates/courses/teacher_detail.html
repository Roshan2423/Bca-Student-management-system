{% extends 'base.html' %}
{% block title %}{{ teacher.full_name }} - Teacher Details{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            {% if teacher %}
                <!-- Header -->
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <div>
                        <h2>
                            {{ teacher.full_name }}
                            {% if not teacher.is_active %}
                                <span class="badge bg-danger ms-2">Inactive</span>
                            {% endif %}
                        </h2>
                        <p class="text-muted mb-0">{{ teacher.designation }} - {{ teacher.department }}</p>
                    </div>
                    <div class="d-flex gap-2 flex-wrap">
                        <a href="{% url 'courses:teacher-list' %}" class="btn btn-outline-secondary">
                            <i class="fas fa-arrow-left"></i> Back to Teachers
                        </a>
                        {% if can_edit %}
                            <a href="{% url 'courses:teacher-edit' teacher.teacher_id %}" class="btn btn-warning">
                                <i class="fas fa-edit"></i> Edit Teacher
                            </a>
                            <a href="{% url 'courses:teacher-password-change' teacher.teacher_id %}" class="btn btn-primary">
                                <i class="fas fa-key"></i> Change Password
                            </a>
                            
                            <!-- Status Toggle Button -->
                            {% if teacher.is_active %}
                                <a href="{% url 'courses:toggle-teacher-status' teacher.teacher_id %}" 
                                   class="btn btn-outline-warning" 
                                   onclick="return confirm('Deactivate this teacher? They will not be able to log in.')">
                                    <i class="fas fa-user-slash"></i> Deactivate
                                </a>
                            {% else %}
                                <a href="{% url 'courses:toggle-teacher-status' teacher.teacher_id %}" 
                                   class="btn btn-outline-success"
                                   onclick="return confirm('Activate this teacher?')">
                                    <i class="fas fa-user-check"></i> Activate
                                </a>
                            {% endif %}
                        {% endif %}
                    </div>
                </div>

                {% if not teacher.is_active %}
                <div class="alert alert-warning mb-4">
                    <i class="fas fa-exclamation-triangle"></i>
                    <strong>Inactive Teacher:</strong> This teacher cannot log in to the system and cannot access teaching features.
                </div>
                {% endif %}

                <!-- Statistics Cards -->   
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="card bg-primary text-white">
                            <div class="card-body">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <h3 class="mb-0">{{ assigned_subjects.count }}</h3>
                                        <p class="mb-0">Subjects Assigned</p>
                                    </div>
                                    <div class="align-self-center">
                                        <i class="fas fa-book fa-2x"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card bg-success text-white">
                            <div class="card-body">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <h3 class="mb-0">{{ total_assignments }}</h3>
                                        <p class="mb-0">Assignments Created</p>
                                    </div>
                                    <div class="align-self-center">
                                        <i class="fas fa-tasks fa-2x"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card bg-info text-white">
                            <div class="card-body">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <h3 class="mb-0">{{ total_materials }}</h3>
                                        <p class="mb-0">Materials Uploaded</p>
                                    </div>
                                    <div class="align-self-center">
                                        <i class="fas fa-file-pdf fa-2x"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card {% if teacher.is_active %}bg-warning{% else %}bg-secondary{% endif %} text-white">
                            <div class="card-body">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <h3 class="mb-0">
                                            {% if teacher.is_active %}
                                                {{ pending_submissions }}
                                            {% else %}
                                                N/A
                                            {% endif %}
                                        </h3>
                                        <p class="mb-0">
                                            {% if teacher.is_active %}
                                                Pending Reviews
                                            {% else %}
                                                Status: Inactive
                                            {% endif %}
                                        </p>
                                    </div>
                                    <div class="align-self-center">
                                        <i class="fas {% if teacher.is_active %}fa-clock{% else %}fa-times-circle{% endif %} fa-2x"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Teacher Information -->
                <div class="row">
                    <div class="col-md-4">
                        <div class="card{% if not teacher.is_active %} border-warning{% endif %}">
                            <div class="card-header{% if not teacher.is_active %} bg-warning text-dark{% endif %}">
                                <h5>
                                    <i class="fas fa-user"></i> Personal Information
                                    {% if not teacher.is_active %}
                                        <span class="badge bg-danger ms-2">Inactive</span>
                                    {% endif %}
                                </h5>
                            </div>
                            <div class="card-body">
                                <table class="table table-sm">
                                    <tr>
                                        <td><strong>Teacher ID:</strong></td>
                                        <td>{{ teacher.teacher_id }}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Email:</strong></td>
                                        <td>{{ teacher.email }}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Phone:</strong></td>
                                        <td>{{ teacher.phone_number|default:"Not provided" }}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Department:</strong></td>
                                        <td>{{ teacher.department }}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Designation:</strong></td>
                                        <td>{{ teacher.designation }}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Experience:</strong></td>
                                        <td>{{ teacher.experience_years }} years</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Status:</strong></td>
                                        <td>
                                            {% if teacher.is_active %}
                                                <span class="badge bg-success">
                                                    <i class="fas fa-check-circle"></i> Active
                                                </span>
                                                <br><small class="text-success">Can access system</small>
                                            {% else %}
                                                <span class="badge bg-danger">
                                                    <i class="fas fa-times-circle"></i> Inactive
                                                </span>
                                                <br><small class="text-danger">Cannot log in</small>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><strong>Joined:</strong></td>
                                        <td>{{ teacher.joining_date|date:"M d, Y" }}</td>
                                    </tr>
                                    {% if teacher.qualification %}
                                    <tr>
                                        <td><strong>Qualification:</strong></td>
                                        <td>{{ teacher.qualification }}</td>
                                    </tr>
                                    {% endif %}
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-8">
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="fas fa-book"></i> Assigned Subjects</h5>
                            </div>
                            <div class="card-body">
                                {% if subjects_by_semester %}
                                    {% for semester, subjects in subjects_by_semester.items %}
                                        <h6 class="text-primary">Semester {{ semester }}</h6>
                                        <div class="row mb-3">
                                            {% for subject in subjects %}
                                                <div class="col-md-6 mb-2">
                                                    <div class="border rounded p-2 bg-light">
                                                        <strong>{{ subject.subject_code }}</strong><br>
                                                        <small>{{ subject.subject_name }}</small>
                                                        <div class="mt-2">
                                                            <a href="{% url 'courses:subject-detail' subject.subject_code %}" 
                                                               class="btn btn-sm btn-outline-primary">
                                                                <i class="fas fa-eye"></i> View
                                                            </a>
                                                            {% if teacher.is_active %}
                                                                <a href="{% url 'courses:upload-material' subject.subject_code %}" 
                                                                   class="btn btn-sm btn-outline-success">
                                                                    <i class="fas fa-upload"></i> Upload
                                                                </a>
                                                                <a href="{% url 'courses:create-assignment' subject.subject_code %}" 
                                                                   class="btn btn-sm btn-outline-info">
                                                                    <i class="fas fa-plus"></i> Assignment
                                                                </a>
                                                            {% else %}
                                                                <span class="badge bg-secondary">
                                                                    <i class="fas fa-lock"></i> Inactive
                                                                </span>
                                                            {% endif %}
                                                        </div>
                                                    </div>
                                                </div>
                                            {% endfor %}
                                        </div>
                                    {% endfor %}
                                {% else %}
                                    <div class="alert alert-info">
                                        <i class="fas fa-info-circle"></i>
                                        No subjects assigned to this teacher yet.
                                        {% if can_edit %}
                                            <a href="{% url 'courses:teacher-edit' teacher.teacher_id %}" class="alert-link">
                                                Assign subjects here
                                            </a>
                                        {% endif %}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>

                {% if teacher.notes %}
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="fas fa-sticky-note"></i> Admin Notes</h5>
                            </div>
                            <div class="card-body">
                                <p>{{ teacher.notes }}</p>
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}

            {% else %}
                <div class="alert alert-danger">
                    <i class="fas fa-exclamation-triangle"></i>
                    Teacher not found!
                </div>
                <a href="{% url 'courses:teacher-list' %}" class="btn btn-primary">
                    <i class="fas fa-arrow-left"></i> Back to Teachers
                </a>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}